/* Begin user.js */
if(typeof BLOOMBERG=="undefined"||!BLOOMBERG)var BLOOMBERG={};(function(){BLOOMBERG.namespace=function(e){var t=[],n,r;t=e.split("."),n=BLOOMBERG,t[0]==="BLOOMBERG"&&t.shift();for(r=0;r<t.length;r++)typeof n[t[r]]=="undefined"&&(n[t[r]]={}),n=n[t[r]];return n}})(),function(){var e=BLOOMBERG.namespace("bw_user"),t={},n={};e.init=function(){},e.field_equality_check=function(e,t,n){return $(e).val()==$(t).val()?($(e).removeClass(n),$(t).removeClass(n),!0):($(e).addClass(n),$(t).addClass(n),!1)},e.modify_message=function(e,t,n,r){n?($(e).removeClass(t),$(e+" .content").html("")):($(e).addClass(t),$(e+" .content").html(r))},e.bind_equality_check=function(t,n,r,i,s){$(t).bind("blur",function(){if($(n).val()!=""){var o=e.field_equality_check(t,n,s);e.modify_message(r,s,o,i)}}),$(n).bind("blur",function(){var o=e.field_equality_check(t,n,s);e.modify_message(r,s,o,i)}),$(n).bind("keyup",function(){if($(n).val().length>0){var o=e.field_equality_check(t,n,s);e.modify_message(r,s,o,i)}})},e.password_strength=function(e){if(e.length<=6)return"poor";var t=e.length,n=e.match(/\d/g);n==null?n=0:n=n.length;var r=e.match(/[a-z]/g);r==null?r=0:r=r.length;var i=e.match(/[A-Z]/g);i==null?i=0:i=i.length;var s=e.match(/\W/g);return s==null?s=0:s=s.length,t>6&&t<10&&n+i+s<=1?"weak":t<10&&n+i+s>1&&n+i+s<=3?"medium":t>=10&&n+i+s>3?"strong":"medium"},e.bind_password_strength_check=function(t,n){$(t).bind("keyup",function(){var r=$(n+" .content");r.html(""),r.addClass("strength");if($(t).val()!=""){r.parent().addClass("error");var i=e.password_strength($(t).val());r.html("Password Strength:<span class='"+i+"'>"+i+"</span>"),r.append("<div class='meter'><div class='"+i+"'></div>")}else r.html(""),r.parent().removeClass("error")})},e.replace_with_username=function(e){var t=_COOKIE.get("bw_email"),n=_COOKIE.get("bw_name"),r="";return n!=""?r=unescape(decodeURIComponent(n)):r=unescape(t),r!=""?($(e).html(""),$("#bloomberg_hat .sign_in").hide(),$("#bloomberg_hat .register").hide(),$("#bloomberg_hat .user_name ").show(),$("#bloomberg_hat .user_name .base").prepend(r),!0):($("#sign_in").show(),!1)},e.is_logged_in=function(){return _COOKIE.get("bw_email")==""?!1:!0},e.init_sign_in_box=function(){var t=e.replace_with_username("#sign_in");t?$("#sign_in").toggle():(sign_in_frame=$("#sign_in .sign_in_frame"),$("#bloomberg_hat .sign_in").live("click",function(e){e.preventDefault(),sign_in_frame.toggle()}),sign_in_frame.find("input").each(function(){$(this).live("focus",function(e){$(this).addClass("active")}),$(this).live("blur",function(e){$(this).removeClass("active")})}),form=$(sign_in_frame).find("form"),form.bind("submit",function(t){t.preventDefault(),e.ajax_sign_on(form)}))},e.unlink_account=function(e){e.preventDefault(),$.ajax({type:"GET",dataType:"json",cache:!1,url:"/users/unlink-account",success:function(e){window.location.reload()},error:function(){}})},e.email_validation_link=function(){$.ajax({type:"GET",dataType:"json",cache:!1,url:"/users/send_validation_email",success:function(e){$("span.email_unconfirmed").text("Confirmation email sent"),$("#flash .message").remove(),$("#flash").append('<div class="message success">'+e.message+"</div>"),$("#flash").show(),$("#flash").delay(1e4).fadeOut("slow")},error:function(){}})},e.init_email_validation=function(){$(".email_validation_link").bind("click",function(t){t.preventDefault(),e.email_validation_link()})},e.init_deactivate_dialog=function(){$("#deactivate_account_message .sure").bind("click",function(t){t.preventDefault(),e.deactivate_account()}),$("#deactivate_account_message .cancel").bind("click",function(t){t.preventDefault(),e.deactivate_account_cancel()})},e.deactivate_account=function(){$.colorbox.close(),$.ajax({type:"GET",dataType:"json",url:"/users/deactivate",cache:!1,success:function(e){window.location="/"},error:function(){}})},e.deactivate_account_cancel=function(){$.colorbox.close()},e.ajax_update_password=function(e){form_data=e.serialize(),$.ajax({type:"PUT",url:e.attr("action"),dataType:"json",data:form_data,success:function(e){window.location="/account"},error:function(e,t,n){$("span.password_error").text(e.responseText)}})},e.validate_password_fields=function(){var e=["#user_form_old_password","#user_form_password","#user_form_confirm_password"],t=!0;return $.each(e,function(e,n){$(n).val().length<2?($(n).addClass("error"),t=!1):$(n).removeClass("error")}),t},e.show_reg=function(){},e.init_update_password=function(){var t=$("#center_rail .change_password");form=t.find("form"),form.bind("submit",function(t){t.preventDefault(),e.validate_password_fields()?e.ajax_update_password(form):$("span.password_error").text("Please enter Password.")})},e.init_show_buttons=function(){$(".new_user_form :input").change(function(){$(".form_buttons").css("display","block")}),$(".subscribable_newsletter_form :input").change(function(){$(".form_buttons").css("display","block")}),$("#selectall").change(function(){$(".form_buttons").css("display","block")})},e.init_select_all_subscription=function(){e.select_or_unselect_all(),$("#selectall").click(function(){$(".bw_newsletter").attr("checked",this.checked)}),$(".bw_newsletter").click(function(){e.select_or_unselect_all()})},e.select_or_unselect_all=function(){$(".bw_newsletter").length==$(".bw_newsletter:checked").length?$("#selectall").attr("checked","checked"):$("#selectall").removeAttr("checked")},e.parse_json_data=function(e){return jQuery.parseJSON(e)},e.invalid_account_error_msg=function(){var e=$("body.registration .reg_details .no_account");$.trim(e.text()).length>0&&e.css({padding:"10px"})},e.redirect_to_homepage=function(){window.location.hash=="#homepage"&&setTimeout("location.href='http://www.businessweek.com/'",12e3)},e.hide_sigin_popup=function(){$("body").click(function(e){if($(".sign_in_frame").is(":visible")==1){var t=$(e.target);!t.parents().is(".sign_in_frame")&&!t.is(".sign_in_frame")&&$("body").find(".sign_in_frame").toggle()}}),$(".sign_in_frame").mouseleave(function(){$(".sign_in_frame").is(":visible")&&$(".sign_in_frame").toggle()})},$(document).ready(function(){e.bind_equality_check("body.registration .new_user #user_form_password","body.registration .new_user #user_form_confirm_password","body.registration .new_user .message.confirm_password","Passwords don't match, please try again","error"),e.bind_password_strength_check("body.registration .new_user #user_form_password","body.registration .new_user .message.password"),e.bind_equality_check("body.registration .password_reset #user_form_password","body.registration .password_reset #user_form_confirm_password","body.registration .password_reset .message.confirm_password","Passwords don't match, please try again","error"),e.bind_password_strength_check("body.registration .password_reset #user_form_password","body.registration .password_reset .message.password"),e.bind_equality_check("body.registration .change_password #user_form_password","body.registration .change_password #user_form_confirm_password","body.registration .change_password .message.confirm_password","Passwords don't match, please try again","error"),e.bind_password_strength_check("body.registration .change_password #user_form_password","body.registration .change_password .message.password"),e.bind_equality_check("body.registration .password_request #user_form_password","body.registration .password_request #user_form_confirm_password","body.registration .password_request .message.confirm_password","Passwords don't match, please try again","error"),e.bind_password_strength_check("body.registration .password_request #user_form_password","body.registration .password_request .message.password"),$(".change_password").hide(),$(".change_password_link").click(function(){$(".change_password").toggle(),$("span.password").toggle(),$(".change_password_link").toggle()}),$(".unlink_facebook").bind("click",function(t){t.preventDefault(),e.unlink_account(t)}),e.init_email_validation(),e.init_deactivate_dialog(),e.init_update_password(),e.init_select_all_subscription(),e.init_show_buttons(),$("#flash").delay(1e4).fadeOut("slow"),e.invalid_account_error_msg(),e.redirect_to_homepage(),e.hide_sigin_popup()})}(),function(e){var t,n={bind_text_input_tracking:function(e,t,r){n.conditional_tracking.apply(this,["blur",e,r])},bind_option_input_tracking:function(e,t,r){n.conditional_tracking.apply(this,["change",e,r])},conditional_tracking:function(n,r,i){return this.each(function(s,o){var u=function(){return e(o).val().length>0},a=function(){var n=new RegExp(t.replace_id_with,"g"),s=e(o).attr("id").replace(n,"");BLOOMBERG.track_event(r,"Field Tracking",s,i)};e(o).do_once_if(n,a,u)})}};e.fn.form_tracking=function(r){t=e.extend({category:"Form Events: "+window.location.pathname,replace_id_with:"",page_number:1,submit_action:"Submit"},r);var i=e(this),s=e(i).find('select, input[type="checkbox"], input[type="radio"]');n.bind_option_input_tracking.apply(s,[t.category,t.page_number]);var o=e(i).find('input[type="text"], input[type="password"], textarea');n.bind_text_input_tracking.apply(o,[t.category,t.page_number]);var u=e(i).find('input[type="submit"]');e(u).live("click",function(){return BLOOMBERG.track_event(t.category,t.submit_action,"Page "+t.page_number),!0})}}(jQuery);